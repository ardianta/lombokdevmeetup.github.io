<!-- Image Carousel Component -->
<div class="carousel-container relative w-full max-w-4xl mx-auto mb-12">
    <!-- Carousel Wrapper -->
    <div class="carousel-wrapper relative overflow-hidden rounded-lg shadow-lg bg-white">
        <!-- Image Container -->
        <div id="carousel-track" class="carousel-track flex transition-transform duration-500 ease-in-out">
            {% assign carousel_images = include.images | default: site.data.carousel.images %}
            {% for image in carousel_images %}
            <div class="carousel-slide flex-shrink-0 w-full">
                <div class="aspect-video bg-gray-100 flex items-center justify-center">
                    <img src="{{ '' | append: image | relative_url }}" 
                         alt="Carousel image {{ forloop.index }}"
                         class="w-full h-full object-cover"
                         loading="lazy"
                         onerror="this.parentElement.innerHTML='<div class=&quot;text-gray-400 text-center&quot;><svg class=&quot;w-16 h-16 mx-auto mb-4&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;><path fill-rule=&quot;evenodd&quot; d=&quot;M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z&quot; clip-rule=&quot;evenodd&quot;></path></svg><p>{{ image }}</p></div>'">
                </div>
                {% if include.captions %}
                <div class="p-4 bg-white">
                    <p class="text-gray-600 text-center">{{ include.captions[forloop.index0] }}</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        
        <!-- Navigation Arrows -->
        <button id="prev-btn" 
                class="carousel-nav absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 p-2 rounded-full shadow-lg transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
        </button>
        
        <button id="next-btn" 
                class="carousel-nav absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 p-2 rounded-full shadow-lg transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </button>
        
        <!-- Play/Pause Button -->
        <button id="play-pause-btn" 
                class="absolute top-4 right-4 bg-white/80 hover:bg-white text-gray-800 p-2 rounded-full shadow-lg transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg id="play-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
            </svg>
            <svg id="pause-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
        </button>
    </div>
    
    <!-- Dot Indicators -->
    <div class="carousel-indicators flex justify-center mt-6 space-x-2">
        {% for image in carousel_images %}
        <button class="carousel-dot w-3 h-3 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 {% if forloop.first %}bg-blue-600{% else %}bg-gray-300 hover:bg-gray-400{% endif %}" 
                data-slide="{{ forloop.index0 }}"></button>
        {% endfor %}
    </div>
    
    <!-- Image Counter -->
    <div class="text-center mt-4">
        <span id="slide-counter" class="text-sm text-gray-500">
            1 / {{ carousel_images.size }}
        </span>
    </div>
</div>

<!-- Carousel Styles -->
<style>
.carousel-track {
    display: flex;
    width: 100%;
}

.carousel-slide {
    flex: 0 0 100%;
    width: 100%;
}

.carousel-nav {
    opacity: 0;
    transition: opacity 0.3s ease;
}

.carousel-container:hover .carousel-nav {
    opacity: 1;
}

.carousel-nav:hover {
    transform: translateY(-50%) scale(1.1);
}

.carousel-dot {
    cursor: pointer;
}

.carousel-dot.active {
    background-color: #3B82F6;
}

/* Swipe indicators for mobile */
@media (max-width: 768px) {
    .carousel-nav {
        opacity: 0.7;
    }
    
    .carousel-container::after {
        content: 'Swipe to navigate';
        position: absolute;
        bottom: -2rem;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.75rem;
        color: #9CA3AF;
        pointer-events: none;
    }
}

/* Loading state */
.carousel-slide img {
    transition: opacity 0.3s ease;
}

.carousel-slide img[src=""] {
    opacity: 0;
}

/* Smooth transitions */
.carousel-track {
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Fullscreen mode styles */
.carousel-fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 9999;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
}

.carousel-fullscreen .carousel-wrapper {
    max-width: 90vw;
    max-height: 90vh;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
}
</style>

<!-- Carousel JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const carousel = {
        track: document.getElementById('carousel-track'),
        slides: document.querySelectorAll('.carousel-slide'),
        prevBtn: document.getElementById('prev-btn'),
        nextBtn: document.getElementById('next-btn'),
        playPauseBtn: document.getElementById('play-pause-btn'),
        playIcon: document.getElementById('play-icon'),
        pauseIcon: document.getElementById('pause-icon'),
        dots: document.querySelectorAll('.carousel-dot'),
        counter: document.getElementById('slide-counter'),
        currentSlide: 0,
        isPlaying: true,
        autoplayInterval: null,
        touchStartX: 0,
        touchEndX: 0
    };
    
    // Initialize carousel
    function init() {
        if (!carousel.track || carousel.slides.length === 0) return;
        
        setupEventListeners();
        startAutoplay();
        updateCarousel();
    }
    
    // Event listeners
    function setupEventListeners() {
        carousel.prevBtn?.addEventListener('click', () => prevSlide());
        carousel.nextBtn?.addEventListener('click', () => nextSlide());
        carousel.playPauseBtn?.addEventListener('click', () => toggleAutoplay());
        
        // Dot navigation
        carousel.dots.forEach((dot, index) => {
            dot.addEventListener('click', () => goToSlide(index));
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') prevSlide();
            if (e.key === 'ArrowRight') nextSlide();
            if (e.key === ' ') {
                e.preventDefault();
                toggleAutoplay();
            }
        });
        
        // Touch/swipe support
        carousel.track.addEventListener('touchstart', handleTouchStart, { passive: true });
        carousel.track.addEventListener('touchend', handleTouchEnd, { passive: true });
        
        // Pause on hover
        carousel.track.addEventListener('mouseenter', () => {
            if (carousel.isPlaying) pauseAutoplay();
        });
        
        carousel.track.addEventListener('mouseleave', () => {
            if (carousel.isPlaying) startAutoplay();
        });
        
        // Visibility API - pause when tab is not visible
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                pauseAutoplay();
            } else if (carousel.isPlaying) {
                startAutoplay();
            }
        });
    }
    
    // Navigation functions
    function nextSlide() {
        carousel.currentSlide = (carousel.currentSlide + 1) % carousel.slides.length;
        updateCarousel();
    }
    
    function prevSlide() {
        carousel.currentSlide = carousel.currentSlide === 0 ? carousel.slides.length - 1 : carousel.currentSlide - 1;
        updateCarousel();
    }
    
    function goToSlide(index) {
        carousel.currentSlide = index;
        updateCarousel();
    }
    
    // Update carousel display
    function updateCarousel() {
        if (!carousel.track || carousel.slides.length === 0) return;
        
        const slideWidth = carousel.track.offsetWidth / carousel.slides.length;
        const translateX = -carousel.currentSlide * 100;
        carousel.track.style.transform = `translateX(${translateX}%)`;
        
        // Update dots
        carousel.dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === carousel.currentSlide);
            if (index === carousel.currentSlide) {
                dot.classList.add('bg-blue-600');
                dot.classList.remove('bg-gray-300');
            } else {
                dot.classList.remove('bg-blue-600');
                dot.classList.add('bg-gray-300');
            }
        });
        
        // Update counter
        if (carousel.counter) {
            carousel.counter.textContent = `${carousel.currentSlide + 1} / ${carousel.slides.length}`;
        }
    }
    
    // Autoplay functions
    function startAutoplay() {
        if (carousel.autoplayInterval) return;
        
        carousel.autoplayInterval = setInterval(() => {
            nextSlide();
        }, 4000); // 4 seconds per slide
    }
    
    function pauseAutoplay() {
        if (carousel.autoplayInterval) {
            clearInterval(carousel.autoplayInterval);
            carousel.autoplayInterval = null;
        }
    }
    
    function toggleAutoplay() {
        carousel.isPlaying = !carousel.isPlaying;
        
        if (carousel.isPlaying) {
            startAutoplay();
            carousel.playIcon.classList.add('hidden');
            carousel.pauseIcon.classList.remove('hidden');
        } else {
            pauseAutoplay();
            carousel.playIcon.classList.remove('hidden');
            carousel.pauseIcon.classList.add('hidden');
        }
    }
    
    // Touch/swipe handlers
    function handleTouchStart(e) {
        carousel.touchStartX = e.changedTouches[0].screenX;
    }
    
    function handleTouchEnd(e) {
        carousel.touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    }
    
    function handleSwipe() {
        const swipeThreshold = 50;
        const diff = carousel.touchStartX - carousel.touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0) {
                nextSlide();
            } else {
                prevSlide();
            }
        }
    }
    
    // Intersection Observer for performance
    function setupIntersectionObserver() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    if (carousel.isPlaying) startAutoplay();
                } else {
                    pauseAutoplay();
                }
            });
        });
        
        observer.observe(carousel.track);
    }
    
    // Initialize everything
    init();
    setupIntersectionObserver();
});

// Utility function to dynamically create carousel from image list
function createCarousel(imageList, containerId, options = {}) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    const {
        autoplay = true,
        interval = 4000,
        showDots = true,
        showArrows = true,
        showCounter = true,
        captions = []
    } = options;
    
    let carouselHTML = `
        <div class="carousel-container relative w-full max-w-4xl mx-auto mb-12">
            <div class="carousel-wrapper relative overflow-hidden rounded-lg shadow-lg bg-white">
                <div class="carousel-track flex transition-transform duration-500 ease-in-out">
    `;
    
    imageList.forEach((image, index) => {
        carouselHTML += `
            <div class="carousel-slide flex-shrink-0 w-full">
                <div class="aspect-video bg-gray-100 flex items-center justify-center">
                    <img src="/assets/images/${image}" 
                         alt="Carousel image ${index + 1}"
                         class="w-full h-full object-cover"
                         loading="lazy">
                </div>
                ${captions[index] ? `<div class="p-4 bg-white"><p class="text-gray-600 text-center">${captions[index]}</p></div>` : ''}
            </div>
        `;
    });
    
    carouselHTML += `
                </div>
                ${showArrows ? `
                    <button class="carousel-nav absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 p-2 rounded-full shadow-lg transition-all duration-200 hover:scale-110">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <button class="carousel-nav absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 p-2 rounded-full shadow-lg transition-all duration-200 hover:scale-110">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                ` : ''}
            </div>
            
            ${showDots ? `
                <div class="carousel-indicators flex justify-center mt-6 space-x-2">
                    ${imageList.map((_, index) => `
                        <button class="carousel-dot w-3 h-3 rounded-full transition-all duration-200 ${index === 0 ? 'bg-blue-600' : 'bg-gray-300 hover:bg-gray-400'}" 
                                data-slide="${index}"></button>
                    `).join('')}
                </div>
            ` : ''}
            
            ${showCounter ? `
                <div class="text-center mt-4">
                    <span class="slide-counter text-sm text-gray-500">1 / ${imageList.length}</span>
                </div>
            ` : ''}
        </div>
    `;
    
    container.innerHTML = carouselHTML;
}
</script>