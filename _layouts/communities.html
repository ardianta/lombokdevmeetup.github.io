---
layout: default
---

<style>
  .communities-wrap { max-width: 1100px; margin: 0 auto; padding: 24px; padding-top: 90px; }
  .controls { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:18px; }
  .controls input, .controls select { padding:8px 10px; font-size:14px; }
  #speakers-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap:12px; }

  .speaker-card {
    position:relative;
    display:flex; flex-direction:column; align-items:center;
    text-decoration:none; color:inherit;
    border:1px solid #e6e6e6; border-radius:12px; padding:14px; background:#fff;
    box-shadow:0 6px 18px rgba(10,10,10,0.03); transition:transform .12s ease;
    z-index: 1; /* keep base stacking for card itself */
  }
  .speaker-card:hover { transform:translateY(-4px); }
  .speaker-card img { width:80px; height:80px; border-radius:50%; object-fit:cover; margin-bottom:8px; }
  .speaker-name { font-weight:600; text-align:center; font-size:0.95rem; line-height:1.2; }
  .speaker-badge {
    position:absolute; top:10px; right:10px;
    background:#0073b1; color:#fff; font-weight:700; font-size:12px;
    padding:4px 8px; border-radius:999px;
  }

  /* Global tooltip (appended to body via JS) */
  .global-tooltip {
    position: absolute;
    pointer-events: none;       /* never block mouse events */
    white-space: nowrap;        /* do not wrap lines */
    z-index: 9999999;           /* very high, will be above everything */
    background: #222;
    color: #fff;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.8rem;
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    transform-origin: center top;
    transition: opacity .12s ease;
    opacity: 0;
    display: block;             /* kept in DOM; JS sets opacity/visibility */
  }
  .global-tooltip.visible { opacity: 1; }

  .global-tooltip strong { display:block; margin-bottom:6px; }
  .global-tooltip ol { margin: 0; padding-left: 18px; }
  .global-tooltip li { margin: 2px 0; }

  /* small responsive fallback: if viewport too small, allow wrapping */
  @media (max-width: 420px) {
    .global-tooltip { white-space: normal; max-width: calc(100vw - 20px); }
  }
</style>

<div class="communities-wrap pt-44 pb-16 px-6 max-w-4xl mx-auto">
  <h2>{{ page.title | default: "Communities" }}</h2>

  <div class="controls">
    <input id="search" type="search" placeholder="Search speakers (name / topic / linkedin)..." />
    <select id="sort">
      <option value="az">Sort A → Z</option>
      <option value="za">Sort Z → A</option>
      <option value="most">Most Appearances</option>
    </select>
  </div>

  {% assign speakers = "" | split: "|" %}

  {% for event in site.events %}
    {% if event.speakers %}
      {% for sp in event.speakers %}
        {% if sp.url contains "linkedin.com" %}
          {% assign display_url = sp.url %}
        {% else %}
          {% continue %}
        {% endif %}

        {% assign key = display_url | remove: "https://" | remove: "http://" | remove: "www." | replace: "/", "" | downcase %}
        {% assign updated = false %}
        {% assign new_speakers = "" | split: "|" %}

        {% for item in speakers %}
          {% if item != "" %}
            {% assign parts = item | split: "|||" %}
            {% assign ex_key = parts[0] %}
            {% assign ex_display = parts[1] %}
            {% assign ex_name = parts[2] %}
            {% assign ex_count = parts[3] %}
            {% assign ex_history = parts[4] | default: "" %}

            {% if ex_key == key %}
              {% assign cur_name = sp.name %}
              {% if cur_name.size > ex_name.size %}
                {% assign chosen_name = cur_name %}
              {% else %}
                {% assign chosen_name = ex_name %}
              {% endif %}
              {% assign new_count = ex_count | plus: 1 %}

              {% assign history_entry = event.title | append: " (" | append: event.event_date | append: ") - " | append: sp.topic %}
              {% assign new_history = ex_history | append: ";;;" | append: history_entry %}

              {% assign updated_item = ex_key | append: "|||" | append: ex_display | append: "|||" | append: chosen_name | append: "|||" | append: new_count | append: "|||" | append: new_history %}
              {% assign new_speakers = new_speakers | push: updated_item %}
              {% assign updated = true %}
            {% else %}
              {% assign new_speakers = new_speakers | push: item %}
            {% endif %}
          {% endif %}
        {% endfor %}

        {% if updated == false %}
          {% assign history_entry = event.title | append: " (" | append: event.event_date | append: ") - " | append: sp.topic %}
          {% assign new_item = key | append: "|||" | append: display_url | append: "|||" | append: sp.name | append: "|||" | append: "1" | append: "|||" | append: history_entry %}
          {% assign new_speakers = new_speakers | push: new_item %}
        {% endif %}

        {% assign speakers = new_speakers %}
      {% endfor %}
    {% endif %}
  {% endfor %}

  <!-- Render the grid -->
  <div id="speakers-grid">
  {% for item in speakers %}
    {% if item != "" %}
      {% assign parts = item | split: "|||" %}
      {% assign key = parts[0] %}
      {% assign display_url = parts[1] %}
      {% assign name = parts[2] %}
      {% assign count = parts[3] %}
      {% assign history_raw = parts[4] %}
      {% assign history_list = history_raw | split: ";;;" %}

      {% assign slug = display_url | split: "/" | last %}
      {% assign slug_first = slug | split: "-" | first %}
      {% assign name_file = name | downcase | replace: " ", "-" %}
      {% assign first_word = name | split: " " | first | downcase %}

      {% assign file_jpeg_slug = "../assets/lombokdev/speakers/" | append: slug_first | append: ".jpeg" %}
      {% assign file_jpg_slug  = "../assets/lombokdev/speakers/" | append: slug_first | append: ".jpg" %}
      {% assign file_png_slug  = "../assets/lombokdev/speakers/" | append: slug_first | append: ".png" %}

      {% assign file_jpeg_name = "../assets/lombokdev/speakers/" | append: name_file | append: ".jpeg" %}
      {% assign file_jpg_name  = "../assets/lombokdev/speakers/" | append: name_file | append: ".jpg" %}
      {% assign file_png_name  = "../assets/lombokdev/speakers/" | append: name_file | append: ".png" %}

      {% assign file_jpeg_first = "../assets/lombokdev/speakers/" | append: first_word | append: ".jpeg" %}
      {% assign file_jpg_first  = "../assets/lombokdev/speakers/" | append: first_word | append: ".jpg" %}
      {% assign file_png_first  = "../assets/lombokdev/speakers/" | append: first_word | append: ".png" %}

      <a class="speaker-card"
         href="{{ display_url }}" target="_blank" rel="noopener noreferrer"
         data-name="{{ name | escape }}"
         data-url="{{ display_url | escape }}"
         data-count="{{ count }}"
         data-history="{{ history_raw | escape }}">
        <img src="{{ file_jpeg_slug }}" alt="{{ name | escape }}"
             onerror="this.onerror=null;
                      this.src='{{ file_jpg_slug }}';
                      this.onerror=function(){this.src='{{ file_png_slug }}'};
                      this.onerror=function(){this.src='{{ file_jpeg_name }}'};
                      this.onerror=function(){this.src='{{ file_jpg_name }}'};
                      this.onerror=function(){this.src='{{ file_png_name }}'};
                      this.onerror=function(){this.src='{{ file_jpeg_first }}'};
                      this.onerror=function(){this.src='{{ file_jpg_first }}'};
                      this.onerror=function(){this.src='{{ file_png_first }}'};
                      this.onerror=function(){this.src='../assets/lombokdev/speakers/placeholder.png'};">
        <div class="speaker-name">{{ name }}</div>
        <div class="speaker-badge">{{ count }}x</div>
      </a>
    {% endif %}
  {% endfor %}
</div>

</div>

<script>
  (function () {
    const searchInput = document.getElementById('search');
    const sortSelect = document.getElementById('sort');
    const grid = document.getElementById('speakers-grid');

    function getCards() {
      return Array.from(grid.querySelectorAll('.speaker-card'));
    }

    function filterCards() {
      const term = (searchInput.value || '').trim().toLowerCase();
      getCards().forEach(card => {
        const name = (card.dataset.name || '').toLowerCase();
        const url = (card.dataset.url || '').toLowerCase();
        const visible = name.includes(term) || url.includes(term);
        card.style.display = visible ? '' : 'none';
      });
    }

    function sortCards(order) {
      const cards = getCards().slice();
      cards.sort((a,b) => {
        const nameA = a.dataset.name.toLowerCase();
        const nameB = b.dataset.name.toLowerCase();
        if (order === 'az') return nameA.localeCompare(nameB);
        if (order === 'za') return nameB.localeCompare(nameA);
        if (order === 'most') {
          const ca = parseInt(a.dataset.count || '0', 10);
          const cb = parseInt(b.dataset.count || '0', 10);
          if (cb === ca) return nameA.localeCompare(nameB);
          return cb - ca;
        }
        return 0;
      });
      cards.forEach(c => grid.appendChild(c));
    }

    searchInput.addEventListener('input', filterCards);
    sortSelect.addEventListener('change', e => sortCards(e.target.value));
    sortCards('az');

    /* ---------------------------
       Global tooltip appended to body
       --------------------------- */
    const tooltip = document.createElement('div');
    tooltip.className = 'global-tooltip';
    tooltip.setAttribute('role', 'tooltip');
    tooltip.style.display = 'none';
    document.body.appendChild(tooltip);

    let activeCard = null;
    let hideTimeout = null;

    function showTooltipFor(card) {
      const historyRaw = card.getAttribute('data-history') || '';
      const items = historyRaw.split(';;;').map(s => s.trim()).filter(Boolean);
      if (!items.length) {
        hideTooltip();
        return;
      }

      // build content via DOM nodes (safe against HTML injection)
      tooltip.innerHTML = ''; // clear
      const strong = document.createElement('strong');
      strong.textContent = 'Speaking at:';
      tooltip.appendChild(strong);

      const ol = document.createElement('ol');
      items.forEach(it => {
        const li = document.createElement('li');
        li.textContent = it;
        ol.appendChild(li);
      });
      tooltip.appendChild(ol);

      // ensure it's visible in DOM to measure
      tooltip.style.display = 'block';
      // allow CSS transition: set visible class next tick
      window.requestAnimationFrame(() => tooltip.classList.add('visible'));

      // position below the card (absolute to the document)
      const rect = card.getBoundingClientRect();

      // measure tooltip width after it's rendered
      const ttRect = tooltip.getBoundingClientRect();
      const ttWidth = ttRect.width;
      const scrollX = window.scrollX || window.pageXOffset;
      const scrollY = window.scrollY || window.pageYOffset;

      // center horizontally on card, but clamp to viewport
      let left = scrollX + rect.left + (rect.width / 2) - (ttWidth / 2);
      const minLeft = scrollX + 8;
      const maxLeft = scrollX + window.innerWidth - ttWidth - 8;
      if (left < minLeft) left = minLeft;
      if (left > maxLeft) left = maxLeft;

      // position just below the card
      const top = scrollY + rect.bottom + 8;

      tooltip.style.left = left + 'px';
      tooltip.style.top = top + 'px';
      tooltip.style.pointerEvents = 'none';

      activeCard = card;
    }

    function hideTooltip() {
      if (!tooltip) return;
      tooltip.classList.remove('visible');
      // allow transition; hide completely after short delay
      clearTimeout(hideTimeout);
      hideTimeout = setTimeout(() => {
        tooltip.style.display = 'none';
        tooltip.innerHTML = '';
      }, 120);
      activeCard = null;
    }

    // attach pointer events to cards
    getCards().forEach(card => {
      card.addEventListener('pointerenter', () => {
        // cancel any pending hide
        clearTimeout(hideTimeout);
        showTooltipFor(card);
      });
      card.addEventListener('pointerleave', () => {
        hideTooltip();
      });
      // keyboard accessibility: show tooltip on focus
      card.addEventListener('focus', () => {
        clearTimeout(hideTimeout);
        showTooltipFor(card);
      });
      card.addEventListener('blur', () => hideTooltip());
    });

    // hide tooltip on scroll / resize (reposition would be nicer, but simple hide is robust)
    let lastScroll = 0;
    window.addEventListener('scroll', () => {
      // only hide if user scrolled more than a few px to avoid flicker
      if (Math.abs(window.scrollY - lastScroll) > 2) {
        hideTooltip();
      }
      lastScroll = window.scrollY;
    }, { passive: true });
    window.addEventListener('resize', hideTooltip);

  })();
</script>
