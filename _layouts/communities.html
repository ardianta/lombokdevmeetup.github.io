---
layout: default
---

<style>
  /* minimal styling — adapt to your site CSS / tailwind as needed */
  .communities-wrap { max-width: 1100px; margin: 0 auto; padding: 24px; padding-top: 90px; }
  .controls { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:18px; }
  .controls input, .controls select { padding:8px 10px; font-size:14px; }
  #speakers-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap:12px; }
  .speaker-card {
    position:relative;
    display:flex; flex-direction:column; align-items:center;
    text-decoration:none; color:inherit;
    border:1px solid #e6e6e6; border-radius:12px; padding:14px; background:#fff;
    box-shadow:0 6px 18px rgba(10,10,10,0.03); transition:transform .12s ease;
  }
  .speaker-card:hover { transform:translateY(-4px); }
  .speaker-card img { width:80px; height:80px; border-radius:50%; object-fit:cover; margin-bottom:8px; }
  .speaker-name { font-weight:600; text-align:center; font-size:0.95rem; line-height:1.2; }
  .speaker-badge {
    position:absolute; top:10px; right:10px;
    background:#0073b1; color:#fff; font-weight:700; font-size:12px;
    padding:4px 8px; border-radius:999px;
  }
</style>

<div class="communities-wrap pt-44 pb-16 px-6 max-w-4xl mx-auto">
  <h2>{{ page.title | default: "Communities" }}</h2>

  <div class="controls">
    <input id="search" type="search" placeholder="Search speakers (name / topic / linkedin)..." />
    <select id="sort">
      <option value="az">Sort A → Z</option>
      <option value="za">Sort Z → A</option>
      <option value="most">Most Appearances</option>
    </select>
  </div>

  {%- comment -%}
    Build an array `speakers` where each item is:
    key|||display_url|||name|||count
    key is normalized url used for dedupe
  {%- endcomment -%}

  {% assign speakers = "" | split: "|" %}

  {% for event in site.events %}
    {% if event.speakers %}
      {% for sp in event.speakers %}
        {% if sp.url contains "linkedin.com" %}
            {% assign display_url = sp.url %}
        {% else %}
            {% continue %}
        {% endif %}

        {% assign key = display_url | remove: "https://" | remove: "http://" | remove: "www." | replace: "/", "" | downcase %}

        {% assign updated = false %}
        {% assign new_speakers = "" | split: "|" %}

        {% for item in speakers %}
          {% if item != "" %}
            {% assign parts = item | split: "|||" %}
            {% assign ex_key = parts[0] %}
            {% assign ex_display = parts[1] %}
            {% assign ex_name = parts[2] %}
            {% assign ex_count = parts[3] %}
            {% if ex_key == key %}
              {% assign cur_name = sp.name %}
              {% if cur_name.size > ex_name.size %}
                {% assign chosen_name = cur_name %}
              {% else %}
                {% assign chosen_name = ex_name %}
              {% endif %}
              {% assign new_count = ex_count | plus: 1 %}
              {% assign updated_item = ex_key | append: "|||" | append: ex_display | append: "|||" | append: chosen_name | append: "|||" | append: new_count %}
              {% assign new_speakers = new_speakers | push: updated_item %}
              {% assign updated = true %}
            {% else %}
              {% assign new_speakers = new_speakers | push: item %}
            {% endif %}
          {% endif %}
        {% endfor %}

        {% if updated == false %}
          {% assign new_item = key | append: "|||" | append: display_url | append: "|||" | append: sp.name | append: "|||" | append: "1" %}
          {% assign new_speakers = new_speakers | push: new_item %}
        {% endif %}

        {% assign speakers = new_speakers %}
      {% endfor %}
    {% endif %}
  {% endfor %}

  <!-- Render the grid -->
  <div id="speakers-grid">
  {% for item in speakers %}
    {% if item != "" %}
      {% assign parts = item | split: "|||" %}
      {% assign key = parts[0] %}
      {% assign display_url = parts[1] %}
      {% assign name = parts[2] %}
      {% assign count = parts[3] %}

      {%- comment -%}
        Image filename resolution order (priority jpeg > jpg > png):
        1. slug-first.jpeg / .jpg / .png
        2. full-name.jpeg / .jpg / .png
        3. first-word.jpeg / .jpg / .png
        4. placeholder.png
      {%- endcomment -%}

      {% assign slug = display_url | split: "/" | last %}
      {% assign slug_first = slug | split: "-" | first %}
      {% assign name_file = name | downcase | replace: " ", "-" %}
      {% assign first_word = name | split: " " | first | downcase %}

      {% assign file_jpeg_slug = "../assets/lombokdev/speakers/" | append: slug_first | append: ".jpeg" %}
      {% assign file_jpg_slug  = "../assets/lombokdev/speakers/" | append: slug_first | append: ".jpg" %}
      {% assign file_png_slug  = "../assets/lombokdev/speakers/" | append: slug_first | append: ".png" %}

      {% assign file_jpeg_name = "../assets/lombokdev/speakers/" | append: name_file | append: ".jpeg" %}
      {% assign file_jpg_name  = "../assets/lombokdev/speakers/" | append: name_file | append: ".jpg" %}
      {% assign file_png_name  = "../assets/lombokdev/speakers/" | append: name_file | append: ".png" %}

      {% assign file_jpeg_first = "../assets/lombokdev/speakers/" | append: first_word | append: ".jpeg" %}
      {% assign file_jpg_first  = "../assets/lombokdev/speakers/" | append: first_word | append: ".jpg" %}
      {% assign file_png_first  = "../assets/lombokdev/speakers/" | append: first_word | append: ".png" %}

      <a class="speaker-card" href="{{ display_url }}" target="_blank" rel="noopener noreferrer"
         data-name="{{ name | escape }}" data-url="{{ display_url | escape }}" data-count="{{ count }}">
        <img src="{{ file_jpeg_slug }}" alt="{{ name | escape }}"
             onerror="this.onerror=null;
                      this.src='{{ file_jpg_slug }}';
                      this.onerror=function(){this.src='{{ file_png_slug }}'};
                      this.onerror=function(){this.src='{{ file_jpeg_name }}'};
                      this.onerror=function(){this.src='{{ file_jpg_name }}'};
                      this.onerror=function(){this.src='{{ file_png_name }}'};
                      this.onerror=function(){this.src='{{ file_jpeg_first }}'};
                      this.onerror=function(){this.src='{{ file_jpg_first }}'};
                      this.onerror=function(){this.src='{{ file_png_first }}'};
                      this.onerror=function(){this.src='../assets/lombokdev/speakers/placeholder.png'};">
        <div class="speaker-name">{{ name }}</div>
        <div class="speaker-badge">{{ count }}x</div>
      </a>
    {% endif %}
  {% endfor %}
</div>

</div>

<script>
  (function () {
    const searchInput = document.getElementById('search');
    const sortSelect = document.getElementById('sort');
    const grid = document.getElementById('speakers-grid');

    function getCards() {
      return Array.from(grid.querySelectorAll('.speaker-card'));
    }

    function filterCards() {
      const term = (searchInput.value || '').trim().toLowerCase();
      getCards().forEach(card => {
        const name = card.dataset.name.toLowerCase();
        const url = card.dataset.url.toLowerCase();
        const visible = name.includes(term) || url.includes(term);
        card.style.display = visible ? '' : 'none';
      });
    }

    function sortCards(order) {
      const cards = getCards().slice();
      cards.sort((a,b) => {
        const nameA = a.dataset.name.toLowerCase();
        const nameB = b.dataset.name.toLowerCase();
        if (order === 'az') return nameA.localeCompare(nameB);
        if (order === 'za') return nameB.localeCompare(nameA);
        if (order === 'most') {
          const ca = parseInt(a.dataset.count || '0', 10);
          const cb = parseInt(b.dataset.count || '0', 10);
          if (cb === ca) return nameA.localeCompare(nameB);
          return cb - ca;
        }
        return 0;
      });
      cards.forEach(c => grid.appendChild(c));
    }

    searchInput.addEventListener('input', filterCards);
    sortSelect.addEventListener('change', e => sortCards(e.target.value));

    // initial sort
    sortCards('az');
  })();
</script>
