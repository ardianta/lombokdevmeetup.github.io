---
layout: default
---

<!-- _layouts/event.html -->
<article class="pt-24 pb-16 px-6 max-w-4xl mx-auto">
  {% if page.banner %}
    <img src="{{ page.banner }}" alt="{{ page.title }}" class="w-full rounded-xl mb-6">
  {% endif %}

  <h1 class="text-4xl font-bold mb-2">{{ page.title }}</h1>
  <p class="text-gray-500 mb-6">📅 {{ page.event_date | date: '%A, %B %d, %Y' }} • 📍 {{ page.location }} • 🕒 {{ page.duration }}</p>

  {% if page.description %}
    <p class="text-lg text-gray-700 mb-8">{{ page.description }}</p>
  {% endif %}

  {% if page.decks %}
    <a href="{{ page.decks }}" target="_blank" class="mb-6 inline-block bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
      View Decks
    </a>
  {% endif %}

  {% if page.agenda %}
    <h2 class="text-2xl font-semibold mb-3">Agenda</h2>
    <ul class="space-y-2 mb-6">
      {% for item in page.agenda %}
        <li>⏰ {{ item.time }} — <strong>{{ item.topic }}</strong>{% if item.speaker %} ({{ item.speaker }}){% endif %}</li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if page.speakers %}
    {% assign sorted_speakers = page.speakers | sort: "name" %}

    <h2 class="text-2xl font-semibold mb-3">Speakers</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6">
      {% for sp in sorted_speakers %}
        {% if sp.url and sp.url contains "linkedin.com/in/" %}
          {% assign slug = sp.url | split: "/" | last %}
          {% assign base = slug | split: "-" | first | downcase %}
        {% else %}
          {% assign base = sp.name | split: " " | first | downcase %}
        {% endif %}

        {% assign file_jpeg = "../assets/lombokdev/speakers/" | append: base | append: ".jpeg" %}
        {% assign file_jpg  = "../assets/lombokdev/speakers/" | append: base | append: ".jpg" %}
        {% assign file_png  = "../assets/lombokdev/speakers/" | append: base | append: ".png" %}

        <div class="relative rounded-xl overflow-hidden shadow-lg">
          <img src="{{ file_jpeg }}"
              alt="{{ sp.name | escape }}"
              class="w-full h-56 object-cover"
              onerror="this.onerror=null;
                        this.src='{{ file_jpg }}';
                        this.onerror=function(){this.src='{{ file_png }}'};
                        this.onerror=function(){this.src='../assets/lombokdev/speakers/placeholder.png'};">
          
          <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white p-3 flex items-center justify-between">
            <span class="font-semibold">{{ sp.name }}</span>
            {% if sp.url and sp.url contains "linkedin.com" %}
              <a href="{{ sp.url }}" target="_blank" rel="noopener noreferrer" class="ml-2">
                <!-- LinkedIn Icon -->
                <svg class="w-5 h-5 text-blue-400 hover:text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M4.98 3.5C4.98 4.88 3.87 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM.4 8.34h4.18V24H.4V8.34zm7.95 0h4.01v2.13h.06c.56-1.06 1.93-2.18 3.98-2.18 4.25 0 5.03 2.8 5.03 6.44V24h-4.18v-7.73c0-1.84-.03-4.2-2.56-4.2-2.56 0-2.95 2-2.95 4.06V24H8.35V8.34z"/>
                </svg>
              </a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}




  {% if page.registration_url %}
    <a href="{{ page.registration_url }}" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Register</a>
  {% endif %}

  {% if page.gallery_url %}
    <a href="{{ page.gallery_url }}" class="mt-3 inline-block bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
      View Gallery
    </a>
  {% endif %}

  <!-- Registration List -->
  <section id="registration-list" class="mt-10">
    <h2 class="text-2xl font-semibold mb-3">Registered Participants</h2>
    <p id="reg-loading" class="text-gray-500">Loading...</p>
    <table id="reg-table" class="hidden w-full border border-gray-300 rounded-lg overflow-hidden">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Full Name</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Email</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Registered At</th>
        </tr>
      </thead>
      <tbody id="reg-body" class="divide-y divide-gray-200"></tbody>
    </table>
  </section>
</article>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const eventId = "{{ page.event_id }}"; // should be defined in front matter
    const apiUrl = "https://xrxfvavgbcphhywznrfq.supabase.co/functions/v1/get-attendance"; 

    try {
      const res = await fetch(`${apiUrl}?event-id=${eventId}`);
      const data = await res.json();

      const loading = document.getElementById("reg-loading");
      const table = document.getElementById("reg-table");
      const body = document.getElementById("reg-body");

      if (!res.ok) {
        loading.textContent = "⚠️ Failed to load registrations.";
        return;
      }

      if (data.length === 0) {
        loading.textContent = "No participants registered yet.";
        return;
      }

      loading.classList.add("hidden");
      table.classList.remove("hidden");

      data.forEach((item) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="px-4 py-2 text-sm text-gray-800">${item.fullname || "-"}</td>
          <td class="px-4 py-2 text-sm text-gray-600">${item.email}</td>
          <td class="px-4 py-2 text-sm text-gray-600">${new Date(item.registered_at).toLocaleString()}</td>
        `;
        body.appendChild(tr);
      });
    } catch (err) {
      console.error("Fetch failed", err);
      document.getElementById("reg-loading").textContent = "⚠️ Unable to load participants.";
    }
  });
</script>
